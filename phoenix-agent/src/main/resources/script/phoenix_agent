function jps_agent_count {
	jps -lvm | awk 'BEGIN{found=0;}$2=="com.dianping.phoenix.agent.PhoenixAgent"{found+=1}END{print found;}'
}

function ps_self_upgrade_count {
	ps ax | grep -E phoenix-agent-self-upgrade.sh.[[:digit:]]+ | wc -l
}

function kill_by_javaclass {
	local javaclass=$1	
	jps -lvm | awk -v javaclass=$javaclass '$2==javaclass{cmd=sprintf("kill -s TERM %s; sleep 1; kill -9 %s", $1, $1);system(cmd)}'
}

function start {
	su phoenix -c "/data/webapps/phoenix/phoenix-agent/startup.sh"
}

function stop {
	kill_by_javaclass "com.dianping.phoenix.agent.PhoenixAgent"
}

function status {
	if [[ `jps_agent_count` -gt 0 || `ps_self_upgrade_count` -gt 0 ]];then
		echo "running"
	else
		echo "stopped"
	fi
}

status
